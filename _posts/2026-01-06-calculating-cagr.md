---
title: 연평균성장률(CAGR) 계산하기
author: Rvinci
description: ‘얼마나’ 변했는지가 아니라 ‘어느 정도 속도’로 변했는지 알고 싶으신가요? 1995~2023년 주민등록인구 데이터를 예로 들어 R에서 n년간 연평균성장률(CAGR)을 계산하는 방법을 알려드립니다.
excerpt: ‘얼마나’ 변했는지가 아니라 ‘어느 정도 속도’로 변했는지 알고 싶으신가요? 1995~2023년 주민등록인구 데이터를 예로 들어 R에서 n년간 연평균성장률(CAGR)을 계산하는 방법을 알려드립니다.
categories: [data]
tags: [r, tidyverse, cagr, lag]
published: true
---

연평균성장률(Compound Annual Growth Rate, CAGR)은 시작값과 끝값을
기준으로, 그 사이가 매년 같은 비율로 변했다고 가정했을 때의 평균
성장률입니다. 연도별로 등락이 있더라도 기간 전체의 흐름을 하나의 숫자로
요약할 수 있어서 장기 추세를 비교할 때 자주 사용합니다. 이번 시간에는
1995~2023년 주민등록인구 데이터를 이용해 연평균성장률(CAGR)을 계산하는
과정을 살펴봅니다.

먼저 엑셀 파일을 읽어오고, 데이터가 기대한 형태로 들어왔는지 앞부분을
확인합니다.

``` r
# 패키지 로드
library(tidyverse)
library(readxl)

# 데이터 로드
data <- read_xlsx("데이터/주민등록인구_시도_1995-2023.xlsx")

# 데이터 확인
head(data)
```

    ## # A tibble: 6 × 3
    ##   행정구역별 시점  `계 (명)`  
    ##   <chr>      <chr> <chr>      
    ## 1 전국       1995  4.5858029E7
    ## 2 전국       1996  4.6266256E7
    ## 3 전국       1997  4.6684069E7
    ## 4 전국       1998  4.6991171E7
    ## 5 전국       1999  4.7335678E7
    ## 6 전국       2000  4.7732558E7

다음으로, 칼럼을 정리합니다. 엑셀에서 인구 칼럼 이름이 ’계 (명)’처럼
들어오는 경우가 많아서, 직관적으로 이해할 수 있는 주민등록인구수로
바꿉니다. 그리고 시점과 인구수는 계산에 써야 하므로 숫자형으로
변환합니다.

``` r
data <- data %>% 
  rename(주민등록인구수 = `계 (명)`) %>% 
  mutate(시점 = as.numeric(시점),
         주민등록인구수 = as.numeric(주민등록인구수))

head(data)
```

    ## # A tibble: 6 × 3
    ##   행정구역별  시점 주민등록인구수
    ##   <chr>      <dbl>          <dbl>
    ## 1 전국        1995       45858029
    ## 2 전국        1996       46266256
    ## 3 전국        1997       46684069
    ## 4 전국        1998       46991171
    ## 5 전국        1999       47335678
    ## 6 전국        2000       47732558

## 연평균성장률(CAGR) 공식 이해하기

CAGR은 아래 공식을 사용합니다. 결과는 ’비율’로 나오기 때문에,
퍼센트(%)로 보고 싶다면 100을 곱하거나 나중에 퍼센트 포맷으로 바꾸면
됩니다.

*C**A**G**R* = (*V*<sub>*f*</sub>/*V*<sub>*i*</sub>)<sup>(1/*n*)</sup> − 1

*V*<sub>*f*</sub>: 최종 값 *V*<sub>*i*</sub>: 초기 값 *n*: 기간(연수)

이 공식을 그대로 함수로 만들어 두면, 1년이든 5년이든 같은 방식으로
재사용할 수 있습니다.

아래 함수는 시작값, 끝값, 시작 연도, 끝 연도를 받아 CAGR을 계산합니다.
연수는 `final_year - initial_year`로 계산합니다.

``` r
cagr <- function(initial_value, final_value, initial_year, final_year){
  years <- final_year - initial_year
  cagr <- ((final_value/initial_value)^(1/years)) - 1
}
```

## 전년도 대비 성장률 구하기

이제 행정구역별로 ’전년도 대비 성장률’을 계산합니다. 핵심은 `lag()`로
이전 연도의 값을 가져오는 것입니다. 예를 들어 1995~1996년 성장률은
1996년 행에 기록됩니다. 그래서 현재 행의 인구수와 `lag()`로 가져온 이전
행의 인구수를 비교합니다.

또한 행정구역마다 따로 계산되어야 하므로 `group_by()`로 묶어 둡니다.
마지막으로 `percent()`로 값을 퍼센트 문자열로 보기 좋게 바꿉니다. 계산을
이어서 하려면 퍼센트 변환 전에 숫자(비율) 형태를 별도로 보관해 두는 것도
좋습니다.

``` r
library(scales)

data %>% 
  arrange(행정구역별, 시점) %>% 
  group_by(행정구역별) %>% 
  mutate(
    `1년 성장률` = cagr(
      lag(주민등록인구수),
      주민등록인구수,
      lag(시점),
      시점
    ),
    `1년 성장률` = percent(`1년 성장률`, accuracy = 0.01)
  )
```

    ## # A tibble: 507 × 4
    ## # Groups:   행정구역별 [18]
    ##    행정구역별      시점 주민등록인구수 `1년 성장률`
    ##    <chr>          <dbl>          <dbl> <chr>       
    ##  1 강원특별자치도  1995        1528488 <NA>        
    ##  2 강원특별자치도  1996        1528671 0.01%       
    ##  3 강원특별자치도  1997        1537106 0.55%       
    ##  4 강원특별자치도  1998        1552667 1.01%       
    ##  5 강원특별자치도  1999        1556979 0.28%       
    ##  6 강원특별자치도  2000        1554688 -0.15%      
    ##  7 강원특별자치도  2001        1552407 -0.15%      
    ##  8 강원특별자치도  2002        1538720 -0.88%      
    ##  9 강원특별자치도  2003        1527034 -0.76%      
    ## 10 강원특별자치도  2004        1521375 -0.37%      
    ## # ℹ 497 more rows

## 5년 연평균성장률 계산하기

5년 단위 CAGR도 구조는 같습니다. 달라지는 점은 ‘5년 전’ 값을 가져와야
한다는 것뿐입니다. `lag(x, n = 5)`처럼 `n` 값을 주면 5행 이전(5년
이전)의 값을 참조합니다. 이렇게 하면 예를 들어 1995~2000년 CAGR이 2000년
행에 계산됩니다.

``` r
data %>% 
  arrange(행정구역별, 시점) %>% 
  group_by(행정구역별) %>% 
  mutate(
    `5년 성장률` = cagr(
      lag(주민등록인구수, n = 5),
      주민등록인구수,
      lag(시점, n = 5),
      시점
    ),
    `5년 성장률` = percent(`5년 성장률`, accuracy = 0.01)
  )
```

    ## # A tibble: 507 × 4
    ## # Groups:   행정구역별 [18]
    ##    행정구역별      시점 주민등록인구수 `5년 성장률`
    ##    <chr>          <dbl>          <dbl> <chr>       
    ##  1 강원특별자치도  1995        1528488 <NA>        
    ##  2 강원특별자치도  1996        1528671 <NA>        
    ##  3 강원특별자치도  1997        1537106 <NA>        
    ##  4 강원특별자치도  1998        1552667 <NA>        
    ##  5 강원특별자치도  1999        1556979 <NA>        
    ##  6 강원특별자치도  2000        1554688 0.34%       
    ##  7 강원특별자치도  2001        1552407 0.31%       
    ##  8 강원특별자치도  2002        1538720 0.02%       
    ##  9 강원특별자치도  2003        1527034 -0.33%      
    ## 10 강원특별자치도  2004        1521375 -0.46%      
    ## # ℹ 497 more rows

이번 글에서는 주민등록인구 데이터를 예로 들어 CAGR을 계산하는 흐름을
정리했습니다. 위 방식은 3년, 10년 등 다양한 기간에 대해서도 그대로
적용할 수 있습니다. `lag(..., n = 기간)`만 바꿔서 같은 패턴으로 계산하면
됩니다.

매출, 사용자 수, 예산, 면적처럼 시간에 따라 변하는 값이라면
연평균성장률을 계산할 수 있습니다!