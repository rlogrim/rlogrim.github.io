---
title: 기술통계량 표 만들기
author: Rvinci
description: 여러 변수의 평균, 표준편차, 범위를 일일이 계산하고 계신가요? R을 이용해 기술통계량 표를 한 번에 만들고, 엑셀파일로 저장하는 방법을 소개합니다.
excerpt: 여러 변수의 평균, 표준편차, 범위를 일일이 계산하고 계신가요? R을 이용해 기술통계량 표를 한 번에 만들고, 엑셀파일로 저장하는 방법을 소개합니다.
categories: [data]
tags: [r, tidyverse, summarise, across, mean, sd, max, min, write_xlsx]
published: true
---

데이터 분석을 시작할 때 가장 먼저 할 일은 복잡한 모델을 돌리는 것이
아니라, 데이터의 전반적인 모습을 빠르게 확인하는 것입니다.

문제는 직접 만들려고 하면 의외로 손이 많이 간다는 점입니다. “변수가 여러
개인데 평균과 표준편차를 한 번에 계산하려면 어떻게 해야 하지?”, “결과를
엑셀에서 보기 좋은 표로 정리하고 싶은데 어디서부터 해야 할까?” 이런
질문에서 막히는 경우가 많습니다.

이번 글에서는 여러 변수의 기술통계량을 한 번에 계산하고, 보기 좋게
정리한 뒤, 엑셀 파일로 저장하는 과정을 단계별로 설명합니다.

## 기술통계량 표란?

기술통계량 표는 데이터를 한눈에 요약해 주는 표입니다. 평균, 표준편차,
최소값, 최대값, 표본수 같은 기본 통계량을 정리하면 데이터의
규모·범위·분포를 빠르게 파악할 수 있습니다. 분석을 시작하기 전에
“데이터가 어떤 모습인지”를 확인하는 가장 간단한 방법이기도 합니다.

## 데이터 준비하기

예제로 전국 시군구의 인구 관련 데이터를 사용해 기술통계량 표를 만들어
봅니다.

사용 변수는 다음 5가지입니다. - 전체 인구 - 65세 이상 인구 -
등록외국인 - 전입인구 - 전출인구

데이터는 통계청의 [국가통계포털(KOSIS)](https://kosis.kr)에서 다운로드할
수 있습니다.

| 데이터 | 출처 |
|------------------------------------|------------------------------------|
| 전체 인구 및 65세 이상 인구 | [고령인구비율(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1YL20631&vw_cd=MT_GTITLE01&list_id=101&scrId=&seqNo=&lang_mode=ko&obj_var_id=&itm_id=&conn_path=MT_GTITLE01&path=%252FstatisticsList%252FstatisticsListIndex.do) |
| 등록외국인 | [등록외국인 현황(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1YL21261&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01) |
| 전입인구 | [전입인구(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=INH_1B26001_A022&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01) |
| 전출인구 | [전출인구(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=INH_1B26001_A023&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01) |

## 엑셀파일 불러온 후 데이터 정리하기

`readxl` 패키지에 있는 `read_xlsx()` 함수를 이용하여 엑셀 파일을
불러옵니다. 열 이름이 제각각이라서 `colnames()` 함수로 열 이름을
정리해줍니다.

또한 전입/전출 데이터에는 성별 정보가 포함돼 있는데 분석에 필요 없으므로
제거합니다. 통합 전 창원시 자료처럼 불필요한 행이 포함될 수 있어
`filter`로 제거해 줍니다.

마지막으로, `left_join()`으로 시도와 시군구를 기준으로 데이터를 하나로
합칩니다.

``` r
# 패키지 로드
library(dplyr)
library(readxl)

# 데이터 로드
고령인구 <- read_xlsx("데이터/인구/고령인구비율_시군구_2023.xlsx", skip=1)
등록외국인 <- read_xlsx("데이터/인구/등록외국인_시군구_2023.xlsx")
전입인구 <- read_xlsx("데이터/인구/전입인구_시군구_2023.xlsx")
전출인구 <- read_xlsx("데이터/인구/전출인구_시군구_2023.xlsx")

# 칼럼명 수정
colnames(고령인구) <- c("시도", "시군구", "65세 이상 인구", "전체 인구")
colnames(등록외국인) <- c("시도", "시군구", "등록외국인")
colnames(전입인구) <- c("시도", "시군구", "성별", "전입인구")
colnames(전출인구) <- c("시도", "시군구", "성별", "전출인구")

# 데이터 가공
전입인구 <- 전입인구 %>% 
  filter(!(시군구=="창원시" & 전입인구==0)) %>% 
  select(-성별)

전출인구 <- 전출인구 %>% 
  filter(!(시군구=="창원시" & 전출인구==0)) %>% 
  select(-성별)

# 데이터 병합
data <- 고령인구 %>% 
  left_join(등록외국인, by=c("시도", "시군구")) %>% 
  left_join(전입인구, by=c("시도", "시군구")) %>% 
  left_join(전출인구, by=c("시도", "시군구")) %>% 
  mutate(시군구=case_when(시군구 == "소계" ~ "",
                       T ~ 시군구)) %>% 
  unite("시군구", 시도:시군구, sep=" ") %>% 
  filter(grepl("(세종특별자치시)|(\\w+\\s\\w+)", 시군구)) %>% 
  mutate(시군구 = str_trim(시군구, side="both"))

# 데이터 확인
head(data)
```

    ## # A tibble: 6 × 6
    ##   시군구              `65세 이상 인구` `전체 인구` 등록외국인 전입인구 전출인구
    ##   <chr>                          <dbl>       <dbl>      <dbl>    <dbl>    <dbl>
    ## 1 서울특별시 종로구              28500      139417      11036    18238    19701
    ## 2 서울특별시 중구                25525      121312      10481    18860    17634
    ## 3 서울특별시 용산구              39239      213151      13955    28429    33660
    ## 4 서울특별시 성동구              49260      277361       7405    34789    38474
    ## 5 서울특별시 광진구              56461      335554      15626    44952    46500
    ## 6 서울특별시 동대문구            66790      341149      18724    50572    45202

## 기술통계량 계산하기

이제 본격적으로 기술통계량을 계산합니다. 흐름은 다음과 같습니다. 1.
`pivot_longer()`로 여러 변수를 “변수-값” 형태로 길게 펼치기 2.
`group_by(변수)`로 변수별로 연산되도록 묶기 3. `summarise()`로 평균,
표준편차, 최소값, 최대값, 표본 수 계산하기

`summarise` 안의 `across(값, ...)` 함수는 `값` 열에 대해 아래에 정의한
계산들을 모두 적용하라는 의미입니다. `list()`에 계산하고 싶은 통계량을
나열하면, 여러 통계를 한 번에 계산할 수 있습니다. 그리고 각 통계량은
`~함수(.x)` 형태로 작성되어 있습니다. `~mean(.x, na.rm = TRUE)`는
`function(x) mean(x, na.rm = TRUE)`와 같은 의미입니다.

``` r
# 기술통계량 표 작성
summary <- data %>% 
  pivot_longer(-시군구, names_to = "변수", values_to = "값") %>% 
  group_by(변수) %>% 
  summarise(across(값,
                   list(평균 =  ~mean(.x, na.rm=T), 
                    표준편차 = ~sd(.x, na.rm=T), 
                    최소값 = ~min(.x, na.rm=T), 
                    최대값 = ~max(.x, na.rm=T), 
                    표본수 = ~sum(!is.na(.x)))
                   )
            )

# 데이터 확인
head(summary)
```

    ## # A tibble: 5 × 6
    ##   변수           값_평균 값_표준편차 값_최소값 값_최대값 값_표본수
    ##   <chr>            <dbl>       <dbl>     <dbl>     <dbl>     <int>
    ## 1 65세 이상 인구  42491.      33305.      2629    180319       229
    ## 2 등록외국인       5889.       7598.       142     52221       229
    ## 3 전입인구        26737.      29972.       972    168024       210
    ## 4 전체 인구      224128.     223217.      9077   1197257       229
    ## 5 전출인구        26712.      29102.      1085    162228       210

## 표 가독성 개선하기

기술통게량 표에는 숫자가 많기 때문에, 출력 형식을 손봐서 읽기 쉽게 만들
필요가 있습니다. `factor()`로 변수 순서를 원하는 대로 지정하고, 변수명
뒤에 단위를 붙입니다. `mutate_if`를 사용해 수치형일 경우 `scales` 패키지의 `comma` 함수를 이용해 숫자 천 단위마다 콤마를 추가합니다.

``` r
# 패키지 로드
library(scales)

# 데이터 표출 포맷 작성
reordered_summary <- summary %>% 
  mutate(변수 = factor(변수, levels = c("전체 인구", "65세 이상 인구", "등록외국인", "전입인구", "전출인구"))) %>% 
  arrange(변수) %>% 
  mutate(across(변수, paste0, "(단위: 명)")
         ) %>% 
  mutate_if(is.numeric, comma, accuracy=1)

# 데이터 확인
head(reordered_summary)
```

    ## # A tibble: 5 × 6
    ##   변수                     값_평균 값_표준편차 값_최소값 값_최대값 값_표본수
    ##   <chr>                    <chr>   <chr>       <chr>     <chr>     <chr>    
    ## 1 전체 인구(단위: 명)      224,128 223,217     9,077     1,197,257 229      
    ## 2 65세 이상 인구(단위: 명) 42,491  33,305      2,629     180,319   229      
    ## 3 등록외국인(단위: 명)     5,889   7,598       142       52,221    229      
    ## 4 전입인구(단위: 명)       26,737  29,972      972       168,024   210      
    ## 5 전출인구(단위: 명)       26,712  29,102      1,085     162,228   210

## 기술통계량 표 엑셀파일로 저장하기

마지막으로 결과를 엑셀파일로 저장합니다. `writexl` 패키지의 `write_xlsx`
함수를 이용하면 됩니다.

``` r
# 패키지 로드
library(writexl)

# 파일 저장
write_xlsx(summary, 
           "아웃풋/분석자료 기술통계량.xlsx")
```

이번 글에서는 여러 엑셀 데이터를 병합한 뒤, `pivot_longer()`와 요약
함수를 조합해 변수별 평균, 표준편차, 최소값, 최대값, 표본 수를 한 번에
정리하는 방법을 살펴봤습니다.

기술통계량 표는 분석을 시작하기 전 데이터의 상태를 빠르게 점검하고,
결측치 여부, 이상치, 범위를 확인하는 데 도움이 됩니다. 현재 사용하는
데이터에 적용해 보세요!