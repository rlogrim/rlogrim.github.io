---
title: 정규표현식 기초 익히고 문자열 다루기
author: Rvinci
description: 형식이 제각각인 문자열 때문에 정리하는 데 시간이 걸린 적이 있나요? stringr 패키지와 정규표현식을 함께 쓰면 문자열에서 원하는 패턴이 있는지 확인하고, 필요한 부분만 뽑아내고, 표기를 같은 형식으로 맞출 수 있습니다. 정규표현식의 기본 개념을 간단히 짚은 뒤, 바로 따라 할 수 있는 예제로 활용 방법을 설명합니다.
excerpt: 형식이 제각각인 문자열 때문에 정리하는 데 시간이 걸린 적이 있나요? stringr 패키지와 정규표현식을 함께 쓰면 문자열에서 원하는 패턴이 있는지 확인하고, 필요한 부분만 뽑아내고, 표기를 같은 형식으로 맞출 수 있습니다. 정규표현식의 기본 개념을 간단히 짚은 뒤, 바로 따라 할 수 있는 예제로 활용 방법을 설명합니다.
categories: [data]
tags: [r, tidyverse, stringr, regex, str_detect, str_replace, str_extract]
published: true
---

## 정규표현식이 왜 필요할까요?

데이터를 다루다 보면 문자열 때문에 어려움을 겪는 경우가 있습니다.
불필요한 문구를 지우고 싶거나, 이메일 주소나 전화번호처럼 특정 형태만
골라 내야 할 때가 대표적입니다. 정규표현식(Regular expression, Regex)은
’어떤 모양이면 같은 종류로 볼지’를 규칙으로 적는 방법입니다.

먼저 자주 쓰는 정규표현식 문법을 정리하고, R에서 `stringr` 패키지로 문자열 패턴을 감지하고(`str_detect()`), 추출하고(`str_extract()`),
대체하는(`str_replace()`) 예시를 보여드리겠습니다.

## 정규표현식 문법, 자주 쓰는 것부터

정규표현식은 ’패턴’을 기호로 표현한 것입니다. 처음부터 전부 외우기보다,
자주 쓰는 구성요소를 익히고 필요할 때 조합하는 편이 이해하기 쉽습니다.

### 문자 클래스(Character class)

문자 클래스는 대괄호 `[]` 안에 ’허용할 문자 집합’을 적는 방식입니다.
아래 표현은 모두 ’글자 하나’를 의미합니다. `-`는 범위를 뜻합니다. `-`
자체를 문자로 쓰고 싶다면 `[]` 안에서 맨 앞이나 맨 뒤에 두면 됩니다.

| 표현       | 의미                  |
|------------|-----------------------|
| `[0-9]`    | 숫자 한 글자          |
| `[a-z]`    | 영문 소문자 한 글자   |
| `[a-zA-Z]` | 영문 대소문자 한 글자 |
| `[가-힣]`  | 한글 한 글자          |
| `[^0-9]`   | 숫자가 아닌 한 글자   |

### 메타문자(Metacharacter)

자주 쓰는 문자 클래스는 더 짧은 기호로도 표현합니다. 보통 ‘백슬래시 +
문자’ 형태입니다. `\D`, `\W`, `\S`처럼 대문자는 소문자의 반대를 의미해서
소문자의 의미만 익히면 됩니다.

| 표현 | 의미                                       |
|------|--------------------------------------------|
| `.`  | 줄바꿈(`\n`)을 제외한 임의의 한 글자       |
| `\d` | 숫자 한 글자 (`[0-9]`)                     |
| `\D` | 숫자가 아닌 한 글자 (`[^0-9]`)             |
| `\w` | 단어 문자(문자/숫자/`_`) 한 글자           |
| `\W` | 단어 문자가 아닌 한 글자                   |
| `\s` | 공백 문자 한 글자(스페이스, 탭, 줄바꿈 등) |
| `\S` | 공백 문자가 아닌 한 글자                   |

### 수량자(Quantifier)

수량자는 ’바로 앞의 요소’를 몇 번 반복할지 정합니다. 예를 들어
`[0-9]{4}`는 숫자 4글자를 뜻해서, 연도를 찾을 때 사용할 수 있습니다.

| 표현    | 의미         |
|---------|--------------|
| `?`     | 0회 또는 1회 |
| `+`     | 1회 이상     |
| `*`     | 0회 이상     |
| `{n}`   | n회          |
| `{n,}`  | n회 이상     |
| `{n,m}` | n회부터 m회  |

### 앵커(Anchor)

앵커는 문자열의 ’위치’를 지정합니다. 예를 들어 `^20`은 ’20으로 시작하는
문자열’을 찾습니다. `$`는 끝을 뜻해서 문자열 끝의 패턴을 지정할 때
사용합니다.

| 표현 | 의미                   |
|------|------------------------|
| `^`  | 문자열(또는 줄)의 시작 |
| `$`  | 문자열(또는 줄)의 끝   |
| `\b` | 단어 경계              |

### 그룹(Group)과 전후방탐색(Look around)

그룹 `()`은 여러 문자를 한 덩어리로 묶어 반복하거나, 나중에 다시 참조할
때 사용합니다.

전후방탐색은 조건만 확인하고, 그 문자는 결과에 포함하지 않습니다.
처음부터 자주 쓰지는 않습니다. 대신 치환이나 추출을 하다가 ’앞뒤 조건은
필요하지만, 그 글자는 결과에서 빼고 싶다’는 상황이 생기면 그때 익혀도
충분합니다.

| 표현      | 의미                     |
|-----------|--------------------------|
| `a(?=b)`  | a 다음에 b가 오는 a      |
| `a(?!b)`  | a 다음에 b가 오지 않는 a |
| `(?<=b)a` | b 다음에 오는 a          |
| `(?<!b)a` | b 다음에 오지 않는 a     |

### R에서는 왜 `\`가 아니라 `\\`를 써야 하나요?

정규표현식에서 `.`은 ’아무 글자 1개’라는 특별한 의미를 가집니다. 그래서
점(`.`) 자체를 찾고 싶다면 정규표현식에서는 `\.`처럼 앞에 백슬래시를
붙여서 ’진짜 점’이라고 표시해야 합니다.

그런데 R에서는 정규표현식을 따옴표로 감싸서 문자열로 적습니다. 이때 R은
문자열 안에서 백슬래시를 먼저 해석합니다. 그래서 정규표현식 엔진에 전달할
`\.`를 만들려면, R 문자열에서는 `\\.`처럼 백슬래시를 한 번 더 적어야
합니다.

R에서는 `\n`(줄바꿈), `\t`(탭) 등이 있어서, 백슬래시와 그 뒤의 문자를
합해 특수한 의미가 있는지를 먼저 확인합니다. `\\.`로 써야, R에서 이를
`\`와 `.`로 구성된 문자 두 개라고 인식하게 됩니다. 이후 정규표현식
엔진이 `\.`를 해석해서 마침표 문자로 매칭하게 되는 것입니다.

## `stringr` 패키지로 정규표현식 사용하기

기본 함수로도 문자열 처리는 가능하지만, `stringr`에 포함된 함수 이름이
직관적이어서 함수를 익히기 좋습니다. `tidyverse`를 쓰는 환경이라면
`stringr`이 이미 포함되어 있습니다.

``` r
library(stringr)
```

처음에는 아래 다섯 가지 함수만 익혀도 대부분의 작업을 처리할 수
있습니다.

| 함수 | 설명 |
|-----------------------------------------------|-------------------------|
| `str_detect(string, pattern)` | 패턴이 있는지 TRUE/FALSE로 확인합니다 |
| `str_extract(string, pattern)` | 처음으로 매칭되는 부분을 뽑습니다 |
| `str_extract_all(string, pattern)` | 매칭되는 모든 부분을 리스트로 뽑습니다 |
| `str_replace(string, pattern, replacement)` | 처음 매칭되는 부분을 바꿉니다 |
| `str_replace_all(string, pattern, replacement)` | 매칭되는 모든 부분을 바꿉니다 |

### 예시 1: 이미지 파일 여부 확인하기

파일 목록에서 이미지 파일만 골라내고 싶을 때가 있습니다. 확장자가 .png,
.jpg, .jpeg, .gif로 끝나는지 확인하면 됩니다. 아래 코드는
`str_detect()`로 각 파일명이 이미지 확장자로 끝나는지 확인합니다. 결과는
파일 개수만큼 TRUE/FALSE로 나옵니다.

``` r
files <- c(
  "logo.png",
  "report.pdf",
  "photo.JPG",
  "plot.jpeg",
  "data.csv",
  "animation.gif"
)

str_detect(files, 
           regex("\\.(png|jpe?g|gif)$", ignore_case = TRUE))
```

    ## [1]  TRUE FALSE  TRUE  TRUE FALSE  TRUE

### 예시 2: 문장 속 이메일 주소 추출하기

문장 형태의 텍스트에서 이메일만 뽑아야 할 때가 있습니다. 이럴 때
`str_extract()`를 쓰면, 문장 전체가 아니라 이메일 형식을 갖춘 문자열만
추출할 수 있습니다.

``` r
text <- c(
  "이메일 주소는 alice@example.com입니다.",
  "john.doe@gmail.com도 사용 중이에요.",
  "다양한 주소들: support@company.com, info@website.or.kr"
)

email_pattern <- "([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,})"

str_extract(text, email_pattern)
```

    ## [1] "alice@example.com"   "john.doe@gmail.com"  "support@company.com"

### 예시 3: 전화번호 표기 통일하기

전화번호가 ‘010-1234-5678’, ‘010 1234 5678’, ‘010.1234.5678’,
‘01012345678’처럼 제각각 들어 있을 때, ’010-1234-5678’ 형태로 통일하는 예시를 살펴보겠습니다.

먼저 숫자가 아닌 문자를 모두 제거합니다. `\\D`는 ’숫자가 아닌 문자’를
뜻하므로, 이를 빈 문자열로 바꾸면 숫자만 남습니다.

``` r
phone <- c("010-1234-5678", "010 1234 5678", "01012345678", "010.1234.5678")

phone_digit <- str_replace_all(phone, "\\D", "")

phone_digit
```

    ## [1] "01012345678" "01012345678" "01012345678" "01012345678"

숫자만 남은 값에 하이픈을 다시 넣습니다. 괄호 `()`로 숫자를 3자리,
4자리, 4자리로 나눠서 그룹으로 잡고, `\\1-\\2-\\3`처럼 그룹을 이어
붙입니다. 문자열 전체가 정확히 11자리 숫자인 경우에만 바꾸도록 `^`와
`$`를 함께 사용했습니다.

``` r
str_replace(phone_digit, 
            "^(\\d{3})(\\d{4})(\\d{4})$", 
            "\\1-\\2-\\3")
```

    ## [1] "010-1234-5678" "010-1234-5678" "010-1234-5678" "010-1234-5678"

정규표현식은 ’패턴’을 기준으로 문자열을 감지하거나, 필요한 부분만
추출하거나, 표기를 같은 규칙으로 통일할 수 있게 해줍니다. 반복해서 손으로
고치던 작업도 코드 한두 줄로 처리할 수 있으니, 데이터에 비슷한 패턴이
보이면 먼저 정규표현식으로 해결할 수 있는지 떠올려 보세요!

더 다양한 함수와 패턴 활용법은 [stringr
cheetsheet](https://github.com/rstudio/cheatsheets/blob/main/strings.pdf)을
참고하면 도움이 됩니다.