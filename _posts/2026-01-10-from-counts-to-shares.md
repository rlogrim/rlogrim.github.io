---
title: 비율 계산하고 보고서용 표 만들기
author: Rvinci
description: 건수나 인구처럼 ‘규모’로 된 데이터로 비율을 계산해 표로 정리하고 싶으신가요? 예시로 시군구별 주민등록인구 데이터를 활용해 시도별로 시, 군, 구 인구 비중을 계산하고 표로 정리하는 방법을 알려드립니다.
excerpt: 건수나 인구처럼 ‘규모’로 된 데이터로 비율을 계산해 표로 정리하고 싶으신가요? 예시로 시군구별 주민등록인구 데이터를 활용해 시도별로 시, 군, 구 인구 비중을 계산하고 표로 정리하는 방법을 알려드립니다.
categories: [data]
tags: [r, tidyverse, group_by, summarise]
published: true
---

현황을 분석할 때, ’규모’뿐만 아니라 ’비율’도 같이 보여주는 경우가 많습니다. 예를 들어, 시도별
인구 수를 보여줄 때, 전국에서 각 시도 인구가 차지하는 비중도 같이
보여주는 것처럼요.

이번 글에서는 전국 시군구별 인구 수를 이용해 시도별로 시, 군, 구에 사는
인구 비율을 계산하고 보고서에 바로 담을 수 있는 형태로 표를 만드는 법을
설명드리겠습니다.

## 데이터 준비하기

분석에 사용할 데이터는 통계청의 [시군구별 주민등록인구
데이터](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1YL20651E&vw_cd=MT_GTITLE01&list_id=101&scrId=&seqNo=&lang_mode=ko&obj_var_id=&itm_id=&conn_path=MT_GTITLE01&path=%252FstatisticsList%252FstatisticsListIndex.do)입니다.
엑셀 파일을 읽어 옵니다. 제목 행이 한 줄 더 포함되어 있어 `skip = 1`을
사용했습니다. 데이터를 보면, 시도, 시군구, 주민등록인구 수로 구성되어
있습니다.

``` r
# 패키지 로드
library(tidyverse)
library(readxl)

# 데이터 로드
data <- read_xlsx("데이터/주민등록인구_시도_시군구_2023.xlsx",
                  skip=1)

# 데이터 확인
head(data)
```

    ## # A tibble: 6 × 3
    ##   `행정구역별(1)` `행정구역별(2)` `계 (명)`
    ##   <chr>           <chr>               <dbl>
    ## 1 전국            소계             51325329
    ## 2 서울특별시      소계              9386034
    ## 3 서울특별시      종로구             139417
    ## 4 서울특별시      중구               121312
    ## 5 서울특별시      용산구             213151
    ## 6 서울특별시      성동구             277361

비율을 계산하기 전에 먼저 불필요한 행을 정리하고, 비교 기준이 되는 분류
변수를 만드는 작업이 필요합니다. 열 이름을 읽기 쉬운 이름으로 바꿉니다.
‘전국’, ‘소계’에 해당하는 행을 제거합니다. 열 이름을 알기 쉽게 바꾸고,
전국 데이터를 제외하며, 불필요한 ’소계’ 데이터를 제거합니다. 마지막으로,
시군구 이름의 끝 글자를 이용해 시, 군, 구 구분을 만듭니다.

``` r
data2 <- data %>% 
  rename(시도 = `행정구역별(1)`,
         시군구 = `행정구역별(2)`,
         주민등록인구수 = `계 (명)`) %>% 
  filter(시도 != "전국",
         (시도 == "세종특별자치시")|(시군구 != "소계")) %>% 
  mutate(시군구 = if_else(시도 == "세종특별자치시", "세종특별자치시", 시군구),
         구분 = case_when(grepl("시$", 시군구) ~ "시",
                        grepl("군$", 시군구) ~ "군",
                        grepl("구$", 시군구) ~ "구"))

head(data2)
```

    ## # A tibble: 6 × 4
    ##   시도       시군구   주민등록인구수 구분 
    ##   <chr>      <chr>             <dbl> <chr>
    ## 1 서울특별시 종로구           139417 구   
    ## 2 서울특별시 중구             121312 구   
    ## 3 서울특별시 용산구           213151 구   
    ## 4 서울특별시 성동구           277361 구   
    ## 5 서울특별시 광진구           335554 구   
    ## 6 서울특별시 동대문구         341149 구

## 규모 데이터 이용해 비율 계산하기

규모 데이터로 비율을 계산할 때는 기준이 되는 ’전체’를 먼저 생각해야
합니다. 이 예시의 기준은 ’시도 전체 인구 수’입니다. 그래서 시도 안에서
시, 군, 구 인구가 각각 얼마나 되는지 합산한 다음, 시도 합계로 나누어
비율을 계산합니다.

먼저, `group_by(시도, 구분)`과 `summarise()`를 이용해 시도별 시, 군, 구
각각에 해당하는 인구 수를 계산합니다. `group_by(시도)`와 `summarise()`를
이용해 시도별로 각 시, 군, 구에 해당하는 인구 수를 전체 시도 인구 수로
나누어 비율을 계산해 줍니다.

``` r
share <- data2 %>% 
  group_by(시도, 구분) %>% 
  summarise(주민등록인구수 = sum(주민등록인구수, na.rm = TRUE)) %>% 
  group_by(시도) %>% 
  mutate(비율 = 주민등록인구수 / sum(주민등록인구수, na.rm = TRUE))

head(share)
```

    ## # A tibble: 6 × 4
    ## # Groups:   시도 [3]
    ##   시도           구분  주민등록인구수   비율
    ##   <chr>          <chr>          <dbl>  <dbl>
    ## 1 강원특별자치도 군            398407 0.261 
    ## 2 강원특별자치도 시           1129400 0.739 
    ## 3 경기도         군            229124 0.0168
    ## 4 경기도         시          13401697 0.983 
    ## 5 경상남도       군            446562 0.137 
    ## 6 경상남도       시           2804596 0.863

## 보고서용 표 만들기

이제 보고서에 맞는 표로 바꾸는 작업만 남았습니다. 같은 결과라도 표
구조가 달라지면 강조되는 부분이 달라집니다. 자주 쓰는 3가지 형태는
아래와 같습니다.

1.  수, 비율을 행으로 쌓는 표
2.  수, 비율을 열로 펼치는 표
3.  수(비율)을 한 셀에 합친 표

### 방법 1: 수, 비율을 행으로 쌓는 표

인구 수와 비율을 각각 한 행으로 두고, 마지막에 합계 열을 붙입니다. 한
시도 안에서 시, 군, 구를 비교하기에 좋습니다.

``` r
library(scales)

rpt1_sebu <- share %>% 
  rename(`인구 수(명)` = 주민등록인구수,
         `비율(%)` = 비율) %>% 
  mutate(구분 = factor(구분, levels = c("시", "군", "구")),
         `인구 수(명)` = comma(`인구 수(명)`),
         `비율(%)` = percent(`비율(%)`, suffix = "", accuracy = .1)) %>% 
  pivot_longer(cols = `인구 수(명)`:`비율(%)`, 
               names_to = "구분2", 
               values_to = "값") %>% 
  pivot_wider(id_cols = c(시도, 구분2), 
              names_from = 구분, 
              values_from = 값,
              names_sort = TRUE)

rpt1_share <- share %>% 
  group_by(시도) %>% 
  summarise(`인구 수(명)` = sum(주민등록인구수, na.rm = TRUE),
            `비율(%)` = sum(비율, na.rm = TRUE)) %>% 
  mutate(`인구 수(명)` = comma(`인구 수(명)`),
         `비율(%)` = percent(`비율(%)`, suffix = "", accuracy = .1)) %>% 
  pivot_longer(cols=-시도, 
               names_to = "구분2", 
               values_to = "합계")

rpt1 <- rpt1_sebu %>% 
  left_join(rpt1_share, by=c("시도", "구분2")) %>% 
  rename(구분 = 구분2)

head(rpt1)
```

    ## # A tibble: 6 × 6
    ## # Groups:   시도 [3]
    ##   시도           구분        시         군      구    합계      
    ##   <chr>          <chr>       <chr>      <chr>   <chr> <chr>     
    ## 1 강원특별자치도 인구 수(명) 1,129,400  398,407 <NA>  1,527,807 
    ## 2 강원특별자치도 비율(%)     73.9       26.1    <NA>  100.0     
    ## 3 경기도         인구 수(명) 13,401,697 229,124 <NA>  13,630,821
    ## 4 경기도         비율(%)     98.3       1.7     <NA>  100.0     
    ## 5 경상남도       인구 수(명) 2,804,596  446,562 <NA>  3,251,158 
    ## 6 경상남도       비율(%)     86.3       13.7    <NA>  100.0

### 방법 2: 수, 비율을 열로 펼치는 표

수와 비율을 가로로 배열하고, 마지막에 합계를 추가합니다. 시도 간 값을
비교할 때 유용한 표입니다.

``` r
rpt2_sebu <- share %>% 
  rename(`인구 수(명)` = 주민등록인구수,
         `비율(%)` = 비율)

rpt2_share <- share %>% 
  group_by(시도) %>% 
  summarise(`인구 수(명)` = sum(주민등록인구수, na.rm = TRUE),
            `비율(%)` = sum(비율, na.rm = TRUE)) %>% 
  mutate(구분 = "합계")

rpt2 <- rpt2_sebu %>% 
  bind_rows(rpt2_share) %>% 
  mutate(구분 = factor(구분, levels = c("시", "군", "구", "합계")),
         `인구 수(명)` = comma(`인구 수(명)`),
         `비율(%)` = percent(`비율(%)`, suffix = "", accuracy = .1)) %>% 
  pivot_wider(id_cols = 시도, 
              names_from = 구분, 
              values_from = `인구 수(명)`:`비율(%)`,
              names_glue = "{구분}_{.value}",
              names_vary = "slowest",
              names_sort = TRUE)

head(rpt2)
```

    ## # A tibble: 6 × 9
    ## # Groups:   시도 [6]
    ##   시도           `시_인구 수(명)` `시_비율(%)` `군_인구 수(명)` `군_비율(%)`
    ##   <chr>          <chr>            <chr>        <chr>            <chr>       
    ## 1 강원특별자치도 1,129,400        73.9         398,407          26.1        
    ## 2 경기도         13,401,697       98.3         229,124          1.7         
    ## 3 경상남도       2,804,596        86.3         446,562          13.7        
    ## 4 경상북도       2,065,707        80.9         488,617          19.1        
    ## 5 광주광역시     <NA>             <NA>         <NA>             <NA>        
    ## 6 대구광역시     <NA>             <NA>         285,072          12.0        
    ## # ℹ 4 more variables: `구_인구 수(명)` <chr>, `구_비율(%)` <chr>,
    ## #   `합계_인구 수(명)` <chr>, `합계_비율(%)` <chr>

### 방법 3: 수(비율)을 한 셀에 합친 표

주민등록인구 수와 비율을 하나의 셀에 병기하고, 합계를 추가합니다.
상대적으로 공간을 덜 차지합니다.

``` r
rpt3_sebu <- share %>% 
  rename(`인구 수(명)` = 주민등록인구수,
         `비율(%)` = 비율) %>% 
  mutate(`인구 수(명)` = comma(`인구 수(명)`),
         `비율(%)` = percent(`비율(%)`, suffix = "", accuracy = .1)) %>% 
  mutate(`인구 수(비율)` = paste0(`인구 수(명)`,
                             "\n(",
                             `비율(%)`,
                             ")"))

rpt3_share <- share %>% 
  group_by(시도) %>% 
  summarise(`인구 수(명)` = sum(주민등록인구수, na.rm = TRUE),
            `비율(%)` = sum(비율, na.rm = TRUE)) %>% 
  mutate(`인구 수(명)` = comma(`인구 수(명)`),
         `비율(%)` = percent(`비율(%)`, suffix = "", accuracy = .1),
         `인구 수(비율)` = paste0(`인구 수(명)`,
                             "\n(",
                             `비율(%)`,
                             ")"),
         구분 = "합계")

rpt3 <- rpt3_sebu %>% 
  bind_rows(rpt3_share) %>% 
  mutate(구분 = factor(구분, levels = c("시", "군", "구", "합계"))) %>% 
  pivot_wider(id_cols = 시도, 
              names_from = 구분, 
              values_from = `인구 수(비율)`,
              names_sort = TRUE)

head(rpt3)
```

    ## # A tibble: 6 × 5
    ## # Groups:   시도 [6]
    ##   시도           시                   군                구                 합계 
    ##   <chr>          <chr>                <chr>             <chr>              <chr>
    ## 1 강원특별자치도 "1,129,400\n(73.9)"  "398,407\n(26.1)"  <NA>              "1,5…
    ## 2 경기도         "13,401,697\n(98.3)" "229,124\n(1.7)"   <NA>              "13,…
    ## 3 경상남도       "2,804,596\n(86.3)"  "446,562\n(13.7)"  <NA>              "3,2…
    ## 4 경상북도       "2,065,707\n(80.9)"  "488,617\n(19.1)"  <NA>              "2,5…
    ## 5 광주광역시      <NA>                 <NA>             "1,419,237\n(100.… "1,4…
    ## 6 대구광역시      <NA>                "285,072\n(12.0)" "2,089,888\n(88.0… "2,3…

이 글에서는 주민등록인구를 다뤘지만, 다른 규모 데이터에도 그대로 적용할
수 있습니다. 연령대별 고객 수, 제품군별 매출처럼 합산 가능한 값이라면
같은 방식으로 비율을 만들 수 있습니다.

기준을 무엇으로 둘지만 정하면 됩니다. 시도 전체 대비인지, 연도 전체
대비인지에 따라 `group_by()`만 수정해 주면 됩니다. 또한, 세 가지 표는
형태만 다를 뿐 같은 결과를 담고 있으니, 문서나 발표자료 형식에 맞는 것을
골라서 써보세요!