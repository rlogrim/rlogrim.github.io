var store = [{
        "title": "그룹별 상하위 데이터 추출하기",
        "excerpt":"이번에는 2023년 시군구별 주민등록인구 데이터를 가지고 분석을 진행해봅니다.  각 시도별로 사람이 가장 많이 모여 사는 시군구 3곳과  조금은 한적한 시군구 3곳을 골라내는 작업입니다.   단순히 데이터를 추출하기만 하면 섭섭하니,  결과를 한눈에 볼 수 있도록 표까지 만들어보겠습니다.   데이터는 통계청의 시군구별 주민등록인구 데이터를 사용합니다.   데이터 구성은 단순합니다.     시도   시군구   주민등록인구수   필요한 재료는 다 모았으니, 이제 R에서 불러옵니다.   # 패키지 로드 library(tidyverse) library(readxl)  # 데이터 로드 data &lt;- read_xlsx(\"데이터/주민등록인구_시도_시군구_2023.xlsx\", skip=1)  # 데이터 확인 head(data)   ## # A tibble: 6 × 3 ##   `행정구역별(1)` `행정구역별(2)` `계 (명)` ##   &lt;chr&gt;           &lt;chr&gt;               &lt;dbl&gt; ## 1 전국            소계             51325329 ## 2 서울특별시      소계              9386034 ## 3 서울특별시      종로구             139417 ## 4 서울특별시      중구               121312 ## 5 서울특별시      용산구             213151 ## 6 서울특별시      성동구             277361   데이터를 열어보면,  익숙한 행정구역 이름들과 함께 인구수가 보입니다.   분석을 시작하기 전에,  rename으로 칼럼 이름부터 사람이 읽기 좋은 형태로 바꿔줍니다.  그리고 filter로 전국 합계나 소계처럼  이번 분석에서는 불필요한 값들은 제거해줍니다.   mutate를 이용해 세종시는 시군구가 따로 없다는 점도  이 김에 같이 처리해 줍니다.   data2 &lt;- data %&gt;%    rename(시도 = `행정구역별(1)`,          시군구 = `행정구역별(2)`,          주민등록인구수 = `계 (명)`) %&gt;%    filter(시도 != \"전국\",          (시도 == \"세종특별자치시\")|(시군구 != \"소계\")) %&gt;%    mutate(시군구 = case_when(시도 == \"세종특별자치시\" ~ \"세종특별자치시\",                          T ~ 시군구))  head(data2)   ## # A tibble: 6 × 3 ##   시도       시군구   주민등록인구수 ##   &lt;chr&gt;      &lt;chr&gt;             &lt;dbl&gt; ## 1 서울특별시 종로구           139417 ## 2 서울특별시 중구             121312 ## 3 서울특별시 용산구           213151 ## 4 서울특별시 성동구           277361 ## 5 서울특별시 광진구           335554 ## 6 서울특별시 동대문구         341149   이제야 비로소 분석하기에 괜찮은 데이터가 되었습니다.   시도별 주민등록인구 수 상위 3개 시군구 추출하기   이제 본격적으로 사람이 많이 사는 곳을 찾아봅니다.  slice_max는 이름 그대로, 많은 쪽부터 잘라주는 함수입니다.   시도별로 묶은 뒤,  주민등록인구 수 기준 상위 3개를 뽑아봅니다.   pop_high &lt;- data2 %&gt;%    group_by(시도) %&gt;%    slice_max(order_by = 주민등록인구수, n = 3)  pop_high   ## # A tibble: 48 × 3 ## # Groups:   시도 [17] ##    시도           시군구     주민등록인구수 ##    &lt;chr&gt;          &lt;chr&gt;               &lt;dbl&gt; ##  1 강원특별자치도 원주시             361503 ##  2 강원특별자치도 춘천시             286426 ##  3 강원특별자치도 강릉시             209439 ##  4 경기도         수원시            1197257 ##  5 경기도         용인시            1075566 ##  6 경기도         고양시            1074907 ##  7 경상남도       통합창원시        1009038 ##  8 경상남도       김해시             533659 ##  9 경상남도       양산시             355122 ## 10 경상북도       포항시             493033 ## # ℹ 38 more rows   결과를 보면,  “역시 이 동네” 싶은 곳들도 있고,  “여기가 이렇게 많았나?” 싶은 곳들도 보입니다.   시도별 주민등록인구 수 하위 3개 시군구 추출하기   이번에는 반대로,  조금은 조용한(?) 지역들을 살펴봅니다.  방법은 거의 동일하고, slice_max가 아닌 slice_min을 사용하면 됩니다.   pop_low &lt;- data2 %&gt;%    group_by(시도) %&gt;%    slice_min(order_by = 주민등록인구수, n = 3)  pop_low   ## # A tibble: 48 × 3 ## # Groups:   시도 [17] ##    시도           시군구 주민등록인구수 ##    &lt;chr&gt;          &lt;chr&gt;           &lt;dbl&gt; ##  1 강원특별자치도 양구군          21056 ##  2 강원특별자치도 화천군          23007 ##  3 강원특별자치도 고성군          27305 ##  4 경기도         연천군          41584 ##  5 경기도         가평군          62302 ##  6 경기도         과천시          81000 ##  7 경상남도       의령군          25475 ##  8 경상남도       산청군          33752 ##  9 경상남도       함양군          36945 ## 10 경상북도       울릉군           9077 ## # ℹ 38 more rows   상·하위 3개 시군구 요약표 만들기   이제 결과를 보고서에 바로 넣을 수 있는 표로 바꿔볼 차례입니다.  상위 3곳, 하위 3곳을 각각  ‘지역명(인구수)’ 형태의 문자열로 만든 뒤,  시도별로 한 줄에 정리합니다.   이를 위해 먼저 paste0를 사용해  각 시군구를 ‘시군구명(인구수)’ 형태의 문자열로 만듭니다.  이때 scales::comma를 함께 사용해  인구 수에 천 단위 구분기호를 추가하면,  보기 좋게 숫자를 보여 수 있습니다.   다음으로 group_by(시도)를 통해 시도별로 데이터를 묶은 뒤,  summarise 안에서 다시 한 번 paste0를 사용해  상위 3개 시군구 정보를 쉼표로 연결된 하나의 문자열로 정리합니다.   이렇게 하면     시도당 한 행만 남고   각 행에는 상·하위 시군구 정보가 깔끔하게 요약되어   보고서나 슬라이드에 그대로 옮겨 쓰기 좋은 형태의 표가 만들어집니다.   library(scales)  pop_high_sum &lt;- pop_high %&gt;%    mutate(`상위 3개 시군구`=paste0(시군구,                            \"(\",                            comma(주민등록인구수, suffix=\"명\"),                            \")\")          ) %&gt;%    group_by(시도) %&gt;%    summarise(`상위 3개 시군구` = paste0(`상위 3개 시군구`, collapse=\", \"))  pop_high_sum   ## # A tibble: 17 × 2 ##    시도           `상위 3개 시군구`                                             ##    &lt;chr&gt;          &lt;chr&gt;                                                         ##  1 강원특별자치도 원주시(361,503명), 춘천시(286,426명), 강릉시(209,439명)       ##  2 경기도         수원시(1,197,257명), 용인시(1,075,566명), 고양시(1,074,907명) ##  3 경상남도       통합창원시(1,009,038명), 김해시(533,659명), 양산시(355,122명) ##  4 경상북도       포항시(493,033명), 구미시(405,506명), 경산시(266,205명)       ##  5 광주광역시     북구(421,683명), 광산구(396,741명), 서구(283,991명)           ##  6 대구광역시     달서구(527,781명), 북구(419,624명), 수성구(407,331명)         ##  7 대전광역시     서구(464,634명), 유성구(366,845명), 중구(223,256명)           ##  8 부산광역시     해운대구(380,448명), 부산진구(359,508명), 사하구(297,831명)   ##  9 서울특별시     송파구(654,166명), 강서구(563,058명), 강남구(544,873명)       ## 10 세종특별자치시 세종특별자치시(386,525명)                                     ## 11 울산광역시     남구(307,232명), 울주군(218,997명), 북구(216,477명)           ## 12 인천광역시     서구(624,358명), 부평구(494,138명), 남동구(492,415명)         ## 13 전라남도       순천시(278,137명), 여수시(271,696명), 목포시(214,156명)       ## 14 전북특별자치도 전주시(642,727명), 익산시(270,036명), 군산시(259,980명)       ## 15 제주특별자치도 제주시(491,654명), 서귀포시(183,598명)                        ## 16 충청남도       천안시(655,959명), 아산시(345,796명), 서산시(176,011명)       ## 17 충청북도       통합청주시(852,189명), 충주시(207,778명), 제천시(130,194명)   하위 3개 시군구에 대해서도 같은 방식으로 정리해줍니다.   pop_low_sum &lt;- pop_low %&gt;%    mutate(`하위 3개 시군구`=paste0(시군구,                            \"(\",                            comma(주민등록인구수, suffix=\"명\"),                            \")\")          ) %&gt;%    group_by(시도) %&gt;%    summarise(`하위 3개 시군구` = paste0(`하위 3개 시군구`, collapse=\", \"))  pop_low_sum   ## # A tibble: 17 × 2 ##    시도           `하위 3개 시군구`                                     ##    &lt;chr&gt;          &lt;chr&gt;                                                 ##  1 강원특별자치도 양구군(21,056명), 화천군(23,007명), 고성군(27,305명)  ##  2 경기도         연천군(41,584명), 가평군(62,302명), 과천시(81,000명)  ##  3 경상남도       의령군(25,475명), 산청군(33,752명), 함양군(36,945명)  ##  4 경상북도       울릉군(9,077명), 영양군(15,661명), 청송군(24,019명)   ##  5 광주광역시     동구(107,176명), 남구(209,646명), 서구(283,991명)     ##  6 대구광역시     군위군(22,988명), 중구(89,064명), 남구(139,187명)     ##  7 대전광역시     대덕구(169,853명), 동구(217,628명), 중구(223,256명)   ##  8 부산광역시     중구(38,619명), 동구(87,792명), 서구(104,089명)       ##  9 서울특별시     중구(121,312명), 종로구(139,417명), 용산구(213,151명) ## 10 세종특별자치시 세종특별자치시(386,525명)                             ## 11 울산광역시     동구(152,287명), 중구(208,668명), 북구(216,477명)     ## 12 인천광역시     옹진군(20,377명), 동구(59,482명), 강화군(69,005명)    ## 13 전라남도       구례군(24,314명), 곡성군(26,905명), 진도군(28,979명)  ## 14 전북특별자치도 장수군(20,983명), 무주군(23,251명), 진안군(24,465명)  ## 15 제주특별자치도 서귀포시(183,598명), 제주시(491,654명)                ## 16 충청남도       청양군(30,168명), 계룡시(46,667명), 서천군(49,116명)  ## 17 충청북도       단양군(27,701명), 보은군(31,010명), 괴산군(36,590명)   마지막으로 left_join을 사용해 상하위 결과를 하나의 표로 합쳐줍니다.   pop_sum &lt;- pop_high_sum %&gt;%    left_join(pop_low_sum, by=\"시도\")  pop_sum   ## # A tibble: 17 × 3 ##    시도           `상위 3개 시군구`                            `하위 3개 시군구` ##    &lt;chr&gt;          &lt;chr&gt;                                        &lt;chr&gt;             ##  1 강원특별자치도 원주시(361,503명), 춘천시(286,426명), 강릉…  양구군(21,056명)… ##  2 경기도         수원시(1,197,257명), 용인시(1,075,566명), …  연천군(41,584명)… ##  3 경상남도       통합창원시(1,009,038명), 김해시(533,659명),… 의령군(25,475명)… ##  4 경상북도       포항시(493,033명), 구미시(405,506명), 경산…  울릉군(9,077명),… ##  5 광주광역시     북구(421,683명), 광산구(396,741명), 서구(28… 동구(107,176명),… ##  6 대구광역시     달서구(527,781명), 북구(419,624명), 수성구(… 군위군(22,988명)… ##  7 대전광역시     서구(464,634명), 유성구(366,845명), 중구(22… 대덕구(169,853명… ##  8 부산광역시     해운대구(380,448명), 부산진구(359,508명), …  중구(38,619명), … ##  9 서울특별시     송파구(654,166명), 강서구(563,058명), 강남…  중구(121,312명),… ## 10 세종특별자치시 세종특별자치시(386,525명)                    세종특별자치시(3… ## 11 울산광역시     남구(307,232명), 울주군(218,997명), 북구(21… 동구(152,287명),… ## 12 인천광역시     서구(624,358명), 부평구(494,138명), 남동구(… 옹진군(20,377명)… ## 13 전라남도       순천시(278,137명), 여수시(271,696명), 목포…  구례군(24,314명)… ## 14 전북특별자치도 전주시(642,727명), 익산시(270,036명), 군산…  장수군(20,983명)… ## 15 제주특별자치도 제주시(491,654명), 서귀포시(183,598명)       서귀포시(183,598… ## 16 충청남도       천안시(655,959명), 아산시(345,796명), 서산…  청양군(30,168명)… ## 17 충청북도       통합청주시(852,189명), 충주시(207,778명), …  단양군(27,701명)…   이번 글에서는  시도별로 주민등록인구 수 상위 3개, 하위 3개 시군구를 추출하고  이를 하나의 요약표로 정리하는 방법을 살펴봤습니다.   인구 데이터뿐만 아니라  매출, 이용자 수, 건수 데이터 등  웬만한 데이터에 그대로 적용할 수 있습니다.   엑셀로 하려면  정렬 → 복사 → 붙여넣기 → 확인 → 다시 정렬…  이 과정에서 한 번 실수라도 했다가는  대참사로 이어지기 쉽습니다.   R은 이런 반복 작업에 특히 강합니다.  한 번 코드를 만들어두면  데이터가 바뀌어도 3초면 정리된 표를 바로 확인할 수 있습니다.  ","categories": ["data"],
        "tags": ["r","tidyverse","data-processing","data-summary"],
        "url": "/data/select-top-bottom-by-group/",
        "teaser": null
      },{
        "title": "여러 지역 병합하기",
        "excerpt":"지도를 그리다 보면, 여러 개의 지역을 하나의 단위로 묶어 표현하고 싶을 때가 있습니다.   이런 경우에는 기존의 행정 경계를 그대로 쓰기보다  경계를 병합해 새로 정리해야 합니다.   이번 글에서는 이런 상황의 한 예로  행정구 경계를 시 단위로 병합하는 방법을 다뤄보겠습니다.   수원시나 성남시처럼 행정구가 설치된 도시를  하나의 시 경계로 정리하는 과정을 차근차근 살펴보겠습니다.   행정구역 경계 데이터 받기   먼저 지도의 기본이 되는 행정구역 경계 데이터를 준비합니다.   V-World 디지털트윈국토에서 ‘행정구역’을 검색하면  행정구역시군구_경계 데이터를 받을 수 있습니다.   이번 시간에는 서울, 인천, 경기를 포함한 수도권 데이터를 사용합니다.   shp 파일 불러오기   shp 파일을 처리하기 위해 sf 패키지를 사용합니다.   list.files()로 폴더 안의 shp 파일 목록을 불러오고,  st_read()로 읽은 뒤  bind_rows()로 하나의 데이터로 합칩니다.   이렇게 하면 수도권 전체 행정구역이  하나의 sf 객체로 정리됩니다.   # 패키지 로드 library(tidyverse) library(sf)  # 데이터 불러오기 folder_path &lt;- \"데이터/수도권 지도/행정구역 경계\"  shp_files &lt;- list.files(folder_path, pattern = \"*.shp$\", full.names = TRUE)  merged_shp &lt;- shp_files %&gt;%    lapply(st_read) %&gt;%    bind_rows()  # 데이터 확인 head(merged_shp)   ## Simple feature collection with 6 features and 4 fields ## Geometry type: MULTIPOLYGON ## Dimension:     XY ## Bounding box:  xmin: 195102.6 ymin: 545229.7 xmax: 210189.8 ymax: 559196.5 ## Projected CRS: Korea_2000_Korea_Central_Belt_2010 ##   ADM_SECT_C              SGG_NM SGG_OID COL_ADM_SE ## 1      11110   서울특별시 종로구      11      11110 ## 2      11140     서울특별시 중구      34      11140 ## 3      11170   서울특별시 용산구       1      11170 ## 4      11200   서울특별시 성동구       1      11200 ## 5      11215   서울특별시 광진구      49      11215 ## 6      11230 서울특별시 동대문구     232      11230 ##                         geometry ## 1 MULTIPOLYGON (((197800 5590... ## 2 MULTIPOLYGON (((202072.4 55... ## 3 MULTIPOLYGON (((197569.6 55... ## 4 MULTIPOLYGON (((203845.4 55... ## 5 MULTIPOLYGON (((208984.4 55... ## 6 MULTIPOLYGON (((206279 5563...   행정구를 정리한 시군구 지도 그리기   이제 행정구를 시 단위로 묶을 차례입니다.   SGG_NM에는 ‘경기도 수원시 장안구’처럼 지역명이 들어 있습니다.  str_replace()를 이용해 구 이름을 제거하고  ‘경기도 수원시’까지만 남깁니다.  이때 사용하는 정규표현식 \"(\\\\s\\\\w+)\\\\s\\\\w+$\"는  문자열의 두 번째 공백 이전 단어를 찾는 역할을 합니다.  ‘경기도 수원시 장안구’는 ‘경기도 수원시’로 바뀝니다.   정규표현식을 사용하면  이처럼 규칙이 있는 문자열을 한 번에 정리할 수 있어,  일괄 처리할 때 특히 유용합니다.   이렇게 이름을 정리한 뒤 group_by()와 summarise()를 적용하면,  같은 시 이름을 가진 경계들이 하나의 행정구역으로 병합됩니다.   # 패키지 로드 library(stringr)   # 행정구역 명칭의 두 번째 공백 뒤 단어를 없애기 result &lt;- merged_shp %&gt;%   mutate(SGG_NM = str_replace(SGG_NM, \"(\\\\s\\\\w+)\\\\s\\\\w+$\", \"\\\\1\")) %&gt;%   group_by(SGG_NM, COL_ADM_SE) %&gt;%   summarise()  # 행정구역 확인 unique(result$SGG_NM)   ##  [1] \"경기도 가평군\"       \"경기도 고양시\"       \"경기도 과천시\"       ##  [4] \"경기도 광명시\"       \"경기도 광주시\"       \"경기도 구리시\"       ##  [7] \"경기도 군포시\"       \"경기도 김포시\"       \"경기도 남양주시\"     ## [10] \"경기도 동두천시\"     \"경기도 부천시\"       \"경기도 성남시\"       ## [13] \"경기도 수원시\"       \"경기도 시흥시\"       \"경기도 안산시\"       ## [16] \"경기도 안성시\"       \"경기도 안양시\"       \"경기도 양주시\"       ## [19] \"경기도 양평군\"       \"경기도 여주시\"       \"경기도 연천군\"       ## [22] \"경기도 오산시\"       \"경기도 용인시\"       \"경기도 의왕시\"       ## [25] \"경기도 의정부시\"     \"경기도 이천시\"       \"경기도 파주시\"       ## [28] \"경기도 평택시\"       \"경기도 포천시\"       \"경기도 하남시\"       ## [31] \"경기도 화성시\"       \"서울특별시 강남구\"   \"서울특별시 강동구\"   ## [34] \"서울특별시 강북구\"   \"서울특별시 강서구\"   \"서울특별시 관악구\"   ## [37] \"서울특별시 광진구\"   \"서울특별시 구로구\"   \"서울특별시 금천구\"   ## [40] \"서울특별시 노원구\"   \"서울특별시 도봉구\"   \"서울특별시 동대문구\" ## [43] \"서울특별시 동작구\"   \"서울특별시 마포구\"   \"서울특별시 서대문구\" ## [46] \"서울특별시 서초구\"   \"서울특별시 성동구\"   \"서울특별시 성북구\"   ## [49] \"서울특별시 송파구\"   \"서울특별시 양천구\"   \"서울특별시 영등포구\" ## [52] \"서울특별시 용산구\"   \"서울특별시 은평구\"   \"서울특별시 종로구\"   ## [55] \"서울특별시 중구\"     \"서울특별시 중랑구\"   \"인천광역시 강화군\"   ## [58] \"인천광역시 계양구\"   \"인천광역시 남동구\"   \"인천광역시 동구\"     ## [61] \"인천광역시 미추홀구\" \"인천광역시 부평구\"   \"인천광역시 서구\"     ## [64] \"인천광역시 연수구\"   \"인천광역시 옹진군\"   \"인천광역시 중구\"   이제 병합된 데이터를 지도로 그려봅니다.   시군구 경계는 얇게, 시도 경계는 조금 더 굵게  레이어를 나눠 표현하면 좋습니다.  지도는 ggplot()과 geom_sf()로 그립니다.  경계 선 색상은 colour, 면 색상은 fill, 선 굵기는 linewidth로 조정할 수 있습니다.   # 패키지 로드 library(ggplot2)  # 지도 작성 ggplot() +   geom_sf(data = result, colour = \"gray40\", fill = NA, linewidth = 0.5) +   geom_sf(data = result_sido, colour = \"gray20\", fill = NA, linewidth = 1) +   theme_void()      지도를 shp 파일로 저장하기   마지막으로, 병합된 지도를 shp 파일로 저장해 두면  다른 작업에서 바로 활용할 수 있어서 편리합니다.  st_write() 함수를 지도를 저장할 수 있습니다.   한글이 깨지지 않도록 UTF-8 인코딩을 함께 지정합니다.  또한, append = FALSE로 지정하여 기존 파일에 덮어쓰기할  수 있도록 설정합니다.   st_write(result,           \"아웃풋/수도권 행정구 병합 지도.shp\",          append = FALSE,          layer_options = \"ENCODING=UTF-8\")   ## Deleting layer `수도권 행정구 병합 지도' using driver `ESRI Shapefile' ## Writing layer `수도권 행정구 병합 지도' to data source  ##   `아웃풋/수도권 행정구 병합 지도.shp' using driver `ESRI Shapefile' ## options:        ENCODING=UTF-8  ## Writing 66 features with 2 fields and geometry type Unknown (any).  ","categories": ["map"],
        "tags": ["r","ggplot2","sf","group_by","summarise"],
        "url": "/map/how-to-merge-regions/",
        "teaser": null
      },{
        "title": "y축 여백을 없애거나 범위 조정하기",
        "excerpt":"차트를 그리다 보면 y축을 그냥 기본값으로 두는 경우가 많습니다.   막상 그래프를 그리고 나서야  “어딘가 좀 답답한데?”  라는 생각이 들기도 하고요.   y축 범위가 적절하지 않으면  데이터 간 차이가 잘 보이지 않거나,  쓸데없는 여백이 눈에 띄기도 합니다.  그래프가 전하고 싶은 메시지도  그만큼 약해질 수 있고요.   붓꽃(iris) 데이터셋을 예로 들어  y축 범위를 언제, 어떻게 조정하면 좋은지 살펴봅니다.  붓꽃 데이터셋은 150개의 붓꽃에 대해  꽃받침과 꽃잎의 길이와 너비를 측정한 데이터입니다.   이 데이터를 이용해 붓꽃 종류별 평균 값을 계산하면  아래와 같은 결과를 얻을 수 있습니다.   head(data)   ## # A tibble: 3 × 5 ##   종류       `꽃받침 길이` `꽃받침 너비` `꽃잎 길이` `꽃잎 너비` ##   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; ## 1 setosa              5.01          3.43        1.46       0.246 ## 2 versicolor          5.94          2.77        4.26       1.33  ## 3 virginica           6.59          2.97        5.55       2.03   이제 이 데이터를 바탕으로 간단한 시각화를 해보겠습니다. 붓꽃 종류별 평균 꽃받침 길이를 막대그래프로 비교해 봤습니다.   ggplot(data=data, aes(x=종류, y=`꽃받침 길이`, label=`꽃받침 길이`)) +   geom_col(width=0.6) +   geom_text(vjust=-0.5, size=12/.pt) +   theme_bw(base_size=12)      그래프를 보면 x축과 막대 사이에 여백이 조금 남아 있습니다.   큰 문제는 아니지만, 이 여백 때문에 그래프 아래가 비어 보이면서  전체적으로 어색한 인상을 줍니다.   이런 경우에는 y축 범위를 조정해  막대가 자연스럽게 x축에 닿도록 만드는 편이 좋습니다.   보통 막대그래프는 0에서 시작합니다   막대그래프 아래 여백을 줄이고 싶다면  y축을 0에서 시작하도록 설정하면 됩니다.   이를 위해 scale_y_continuous() 함수의 expand 옵션을 사용합니다.  expand는 축의 시작과 끝에 들어가는 여백을 조절하는 역할을 합니다.   아래 코드를 추가하면 y축이 0에서 시작하고 불필요한 여백이 정리됩니다. mult의 첫 번째 값 0은 y축 시작 지점의 여백을 제거하고,  두 번째 값 0.1은 y축 상단에 약간의 여백을 추가하는 역할을 합니다.   ggplot(data=data, aes(x=종류, y=`꽃받침 길이`, label=`꽃받침 길이`)) +   geom_col(width=0.6) +   geom_text(vjust=-0.5, size=12/.pt) +   scale_y_continuous(expand=expansion(mult=c(0, 0.1))) +   theme_bw(base_size=12)      차이가 잘 안 보일 땐 y축 범위를 줄입니다   항상 y축이 0에서 시작해야 하는 것은 아닙니다.  0부터 시작하는 y축에서는 값 사이의 차이가 잘 드러나지 않을 수 있습니다.   이럴 때는 보고 싶은 구간만 보여주는 방법이 있습니다.  이때 사용하는 함수가 coord_cartesian()입니다.  데이터를 건드리지 않고 보이는 범위만 조정할 수 있습니다.   그래프를 확대해서 중요한 부분에 시선을 집중하는 느낌이라고 보면 됩니다.   ggplot(data=data, aes(x=종류, y=`꽃받침 길이`, label=`꽃받침 길이`)) +   geom_col(width=0.6) +   geom_text(vjust=-0.5, size=12/.pt) +   scale_y_continuous(expand=expansion(mult=c(0, 0.1))) +   coord_cartesian(ylim=c(3, 7)) +   theme_bw(base_size=12)      축 설정 하나만 바꿔도 그래프의 인상과 전달력이 달라집니다.   다음에 그래프가 어딘가 아쉬워 보인다면, y축 범위를 한 번쯤 조정해 보세요.   생각보다 효과가 큽니다.  ","categories": ["chart"],
        "tags": ["r","ggplot2","y축","scale_y_continuous","coord_cartesian"],
        "url": "/chart/y-axis-range-adjustment-tips/",
        "teaser": null
      },{
        "title": "지도 위에 공간 정보 쌓아보기",
        "excerpt":"행정구역 경계만 있는 지도는  어딘가 밋밋하게 보일 때가 있습니다.   이번 글에서는 행정구역 경계를 기본으로 두고,  산지, 녹지, 수계, 도로 같은 정보를 겹쳐  조금 더 풍부한 정보를 담고 있는 지도를 만들어 보겠습니다.   먼저 사용할 데이터를 준비합니다.  행정구역 경계, 산지, 녹지, 수계, 도로 데이터는 모두  V-World 디지털트윈국토에서 받을 수 있습니다.   다행히 모든 데이터의 좌표계가 GRS80(EPSG: 5186)으로 동일해  좌표계 변환 없이 바로 사용할 수 있습니다.  그래서 좌표계를 맞추는 추가 작업은 필요 없습니다.                  데이터       게시물       좌표계                       행정구역 경계       행정구역시군구_경계       GRS80(EPSG:5186)                 산지       (연속주제)_산지관리/보전준보전산지       GRS80(EPSG:5186)                 녹지       (연속주제)_국토계획/공간시설       GRS80(EPSG:5186)                 수계       실폭하천       GRS80(EPSG:5186)                 도로       (도로명주소)실폭도로       GRS80(EPSG:5186)           여러 shp 파일, 한 번에 불러오기   다운로드한 shp 파일들을 R로 불러옵니다.  행정구역 경계는 이전에 만들어둔  수도권 행정구 병합 지도.shp 파일을 사용합니다.   나머지 데이터는 폴더 안에 여러 shp 파일로 나뉘어 있으므로,  list.files()로 한꺼번에 불러와 bind_rows()로 합쳐줍니다. 이렇게 하면 데이터 종류별로 하나의 sf 객체로 만들 수 있습니다.   # 패키지 로드 library(tidyverse) library(sf)  # 행정구역 경계 지도 로드 sgg &lt;- st_read(\"아웃풋/수도권 행정구 병합 지도.shp\")  # 녹지 데이터 로드 및 병합 folder_path &lt;- \"데이터/수도권 지도/녹지\"  shp_files &lt;- list.files(folder_path, pattern = \"*.shp$\", full.names = TRUE)  green &lt;- shp_files %&gt;%    lapply(st_read) %&gt;%    bind_rows()  # 도로 데이터 로드 및 병합 folder_path &lt;- \"데이터/수도권 지도/도로\"  shp_files &lt;- list.files(folder_path, pattern = \"*.shp$\", full.names = TRUE)  road &lt;- shp_files %&gt;%    lapply(st_read) %&gt;%    bind_rows()  # 산지 데이터 로드 및 병합 folder_path &lt;- \"데이터/수도권 지도/산지\"  shp_files &lt;- list.files(folder_path, pattern = \"*.shp$\", full.names = TRUE)  mt &lt;- shp_files %&gt;%    lapply(st_read) %&gt;%    bind_rows()  # 수계 데이터 로드 및 병합 folder_path &lt;- \"데이터/수도권 지도/수계\"  shp_files &lt;- list.files(folder_path, pattern = \"*.shp$\", full.names = TRUE)  water &lt;- shp_files %&gt;%    lapply(st_read) %&gt;%    bind_rows()   지도에 쓰기 좋게 shp 파일 다듬기   녹지 데이터는 ‘국토계획/공간시설’ 자료에서  필요한 부분만 골라 사용합니다.  용도지역지구 표준분류코드를 기준으로 보면,  광장(UQT100)은 녹지 성격과 거리가 있어 제외했습니다.   MNUM에서 필요한 부분만 잘라낸 뒤,  조건에 맞지 않는 항목을 filter()로 걸러냅니다.   green &lt;- green %&gt;%    mutate(no = substr(MNUM, 21, 24)) %&gt;%    filter(no != \"UQT1\")   산지와 수계 데이터는 전국 단위라 그대로 쓰기엔 너무 큽니다.  그래서 st_intersection()을 이용해  수도권 행정구역(sgg)과 겹치는 부분만 남깁니다.   st_crs(water) &lt;- 5186 st_crs(mt) &lt;- 5186  water &lt;- st_intersection(water, sgg) mt &lt;- st_intersection(mt, sgg)   레이어를 차곡차곡 쌓아서 한 장의 지도로 만들기   이제 모든 재료가 준비됐습니다.  ggplot2의 geom_sf()를 이용해 지도 레이어를 하나씩 쌓아봅니다.  바탕에 행정구역 면, 그 위에 녹지, 산지, 수계, 도로,  마지막으로 행정구역 경계선을 그려줍니다.   축과 배경은 theme_void()로 제거해  지도 자체에만 시선이 가도록 합니다.   ggplot() +   geom_sf(data = sgg, colour=NA, fill=\"#eaeaea\") + # 시군구 영역   geom_sf(data = green, colour=NA, fill=\"#A0D097\") + # 녹지   geom_sf(data = mt, colour=NA, fill=\"#A0D097\") + # 산지   geom_sf(data = water, colour=NA, fill=\"#A5D1F2\") + # 수계   geom_sf(data = road, colour=NA, fill=\"white\", linewidth=0.1) + # 도로   geom_sf(data = sgg, colour=\"white\", fill=NA, linewidth=1.3) + # 시군구 경계   geom_sf(data = sgg, colour=\"gray40\", fill=NA, linewidth=0.5) + # 시군구 경계   theme_void()      행정구역을 뼈대로 삼고,  그 위에 어떤 공간 정보든 자유롭게 얹을 수 있습니다.   예를 들어,     인구, 산업, 시설 밀도 등 점 데이터   도로, 철도, 하천 등 선 데이터   개발제한구역, 용도지역 등 면 데이터   이 방법을 활용해서 목적에 맞는 다양한 지도를 만들어 보세요.  ","categories": ["map"],
        "tags": ["r","ggplot2","sf","st_intersection","geom_sf"],
        "url": "/map/layering-spatial-data/",
        "teaser": null
      }]
