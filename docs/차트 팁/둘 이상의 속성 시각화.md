---
layout: post_comments
title: 둘 이상의 속성 시각화
parent: 차트 팁
published: true
---

# {{ page.title }}
{: .no_toc }

## 목차
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## 데이터 준비

iris 데이터셋을 예시로 사용하겠습니다.

아래 테이블을 보면, 붓꽃 종류별로 꽃받침 길이, 꽃받침 너비, 꽃잎 길이,
꽃잎 너비 등 다양한 정보가 나와 있습니다.

어떻게 하면 이 많은 정보를 효과적으로 시각화하여 보여줄 수 있을까요?

``` r
head(data)
```

    ## # A tibble: 3 × 5
    ##   종류       `꽃받침 길이` `꽃받침 너비` `꽃잎 길이` `꽃잎 너비`
    ##   <fct>              <dbl>         <dbl>       <dbl>       <dbl>
    ## 1 setosa              5.01          3.43        1.46       0.246
    ## 2 versicolor          5.94          2.77        4.26       1.33 
    ## 3 virginica           6.59          2.97        5.55       2.03

먼저 ggplot으로 그리기 쉽도록 데이터를 longer한 형태로 바꿔주겠습니다.

데이터를 longer한 형태로 바꿔주는 함수인 `pivot_longer`를
사용하겠습니다.

아래 코드를 풀어서 설명하면, ’꽃받침 길이’부터 ’꽃잎 너비’까지의 열을
longer한 형태로 바꿀 것이며, ’구분’이라는 새로운 열에는 속성을 넣고,
’값’이라는 새로운 열에는 각 속성에 해당하는 값을 넣겠다는 의미입니다.

``` r
data2 <- data %>% 
  pivot_longer(cols=`꽃받침 길이`:`꽃잎 너비`, names_to="구분", values_to="값")

head(data2)
```

    ## # A tibble: 6 × 3
    ##   종류       구분           값
    ##   <fct>      <chr>       <dbl>
    ## 1 setosa     꽃받침 길이 5.01 
    ## 2 setosa     꽃받침 너비 3.43 
    ## 3 setosa     꽃잎 길이   1.46 
    ## 4 setosa     꽃잎 너비   0.246
    ## 5 versicolor 꽃받침 길이 5.94 
    ## 6 versicolor 꽃받침 너비 2.77

## 하나의 그래프로 그리기

붓꽃과 관련된 네 가지 속성에 대한 정보가 하나의 그래프로 표현될 수
있도록 막대그래프를 그려보겠습니다.

x축은 붓꽃과 관련된 속성을 나타내고, y축은 각 속성에 해당하는 값을
나타냅니다.

``` r
ggplot(data=data2, aes(x=구분, y=값, group=종류)) +
  geom_col(aes(fill=종류), 
           position=position_dodge(width=0.7), width=0.6) +
  geom_text(aes(label=값), 
            position=position_dodge(width=0.6), vjust=-0.5) +
  scale_y_continuous(expand=expansion(mult=c(0, 0.1))) +
  theme_bw()
```

<img src="/assets/images/둘-이상의-속성-시각화/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" />

## 속성별 화면 분할하기

앞서 하나의 그래프에 여러 정보를 담았지만, 속성별로 화면을 분할해 줄
수도 있습니다.

`facet_wrap` 함수를 이용하면 됩니다.

이번 예시에서는 `facet_wrap(vars(구분), nrow=2)`로 입력해 보겠습니다.

`vars(구분)`은 데이터의 ’구분’이라는 변수를 기준으로 화면을 분할하겠다는
의미이고, `nrow=2`는 분할된 화면을 2줄로 배열하겠다는 의미입니다.

``` r
ggplot(data=data2, aes(x=종류, y=값, group=종류)) +
  geom_col(aes(fill=종류), width=0.6) +
  geom_text(aes(label=값), vjust=-0.5) +
  scale_y_continuous(expand=expansion(mult=c(0, 0.2))) +
  facet_wrap(vars(구분), nrow=2) +
  theme_bw()
```

<img src="/assets/images/둘-이상의-속성-시각화/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" />
위 그림을 보면 모든 그래프의 x축이 setosa, versicolor, virginica로
고정되어 있는데, 화면마다 막대그래프가 속성 값을 기준으로 오름차순으로
정렬되도록 x축 순서를 바꿔줄 수도 있습니다.

이를 위해서는 `tidytext`라는 패키지의 `reorder_within`,
`scale_x_reordered` 함수가 필요합니다.

기존 코드의 `aes(x=종류)`를
`aes(x=reorder_within(x=종류, by=값, within=구분))`으로 수정하고,
`scale_x_reordered(name="종류")` 코드를 추가해 줍니다.

’붓꽃 종류’를 ’구분’이라는 카테고리 안에서 ’값’을 기준으로 정렬하라는
의미로 이해하면 됩니다.

그리고 고정되어 있는 x축을 풀어주기 위해, `facet_wrap` 함수 안에
`scales="free_x"`를 입력해 줍니다.

완성된 코드는 아래와 같습니다.

``` r
library(tidytext)

ggplot(data=data2, aes(x=reorder_within(x=종류, by=값, within=구분), y=값, group=종류)) +
  geom_col(aes(fill=종류), width=0.6) +
  geom_text(aes(label=값), vjust=-0.5) +
  scale_x_reordered(name="종류") +
  scale_y_continuous(expand=expansion(mult=c(0, 0.2))) +
  facet_wrap(vars(구분), nrow=2, scales="free_x") +
  theme_bw()
```

<img src="/assets/images/둘-이상의-속성-시각화/unnamed-chunk-5-1.png" width="70%" style="display: block; margin: auto;" />
