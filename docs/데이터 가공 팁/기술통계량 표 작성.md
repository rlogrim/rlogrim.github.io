---
layout: post_comments
title: 기술통계량 표 작성
parent: 데이터 가공 팁
published: true
output:
  md_document:
    variant: markdown_github
    preserve_yaml: true
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, 
  encoding = encoding, 
  output_file=paste0(Sys.Date(), "-", sub(".Rmd", ".md",inputFile)), 
  output_dir = "C:/Users/my910/projects/ggsave/docs/데이터 가공 팁") })
---

# {{ page.title }}
{: .no_toc }

## 기술통계량 표란?

기술통계량 표는 데이터를 요약해 한눈에 보여주는 표입니다. 평균,
표준편차, 최소값, 최대값, 표본수와 같은 기본 통계량을 정리하면 데이터의
분포와 범위를 빠르게 파악할 수 있습니다. 본격적으로 분석을 시작하기 전에
데이터를 이해하고, 주요 특징을 확인하는 첫 단계라고 할 수 있습니다.

## 데이터 준비하기

이번 예제에서는 전국 시군구의 인구 관련 데이터를 사용해 기술통계량 표를
작성합니다. 이번에 사용할 데이터는 전체 인구, 65세 이상 인구,
등록외국인, 전입인구, 전출인구입니다. 모든 데이터는 통계청의
[국가통계포털(KOSIS)](https://kosis.kr)에서 다운로드할 수 있습니다.

| 데이터                      | 출처                                                                                                                                                                                                                                                    |
|------------------------------------|------------------------------------|
| 전체 인구 및 65세 이상 인구 | [고령인구비율(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1YL20631&vw_cd=MT_GTITLE01&list_id=101&scrId=&seqNo=&lang_mode=ko&obj_var_id=&itm_id=&conn_path=MT_GTITLE01&path=%252FstatisticsList%252FstatisticsListIndex.do) |
| 등록외국인                  | [등록외국인 현황(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=DT_1YL21261&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01)                                            |
| 전입인구                    | [전입인구(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=INH_1B26001_A022&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01)                                              |
| 전출인구                    | [전출인구(시도/시/군/구)](https://kosis.kr/statHtml/statHtml.do?orgId=101&tblId=INH_1B26001_A023&vw_cd=MT_GTITLE01&list_id=101&seqNo=&lang_mode=ko&language=kor&obj_var_id=&itm_id=&conn_path=MT_GTITLE01)                                              |

`read_xlsx` 함수를 이용해 전체 인구, 65세 이상 인구, 등록외국인,
전입인구, 전출인구 데이터를 통계청에서 다운받아 각각 엑셀 파일로
불러옵니다. 불러온 데이터의 열 이름이 서로 다르기 때문에, 통일된 형태로
정리해야 합니다. `colnames` 함수를 사용해 각 열 이름을 동일하게
수정합니다. 또한, 전입인구와 전출인구 데이터에는 성별 정보가 포함되어
있으므로 `select`를 이용해 해당 열을 제거합니다. 또한, 통합 전 창원시
자료도 데이터에 포함되어 있어 이를 제거하기 위해 일부 조건을 걸어
불필요한 행을 제거합니다. 데이터 정리가 끝나면, `left_join`을 사용해
’시도’와 ’시군구’를 기준으로 여러 데이터를 하나로 합칩니다. 이 과정에서
불필요한 행을 걸러내고, 시도와 시군구를 결합해 하나의 열로 만듭니다.
데이터 병합이 완료되면 전국 229개 시군구의 인구 관련 데이터가 깔끔하게
정리됩니다.

``` r
# 패키지 로드
library(dplyr)
library(readxl)

# 데이터 로드
고령인구 <- read_xlsx("데이터/인구/고령인구비율_시군구_2023.xlsx", skip=1)
등록외국인 <- read_xlsx("데이터/인구/등록외국인_시군구_2023.xlsx")
전입인구 <- read_xlsx("데이터/인구/전입인구_시군구_2023.xlsx")
전출인구 <- read_xlsx("데이터/인구/전출인구_시군구_2023.xlsx")

# 칼럼명 수정
colnames(고령인구) <- c("시도", "시군구", "65세 이상 인구", "전체 인구")
colnames(등록외국인) <- c("시도", "시군구", "등록외국인")
colnames(전입인구) <- c("시도", "시군구", "성별", "전입인구")
colnames(전출인구) <- c("시도", "시군구", "성별", "전출인구")

# 데이터 가공
전입인구 <- 전입인구 %>% 
  filter(!(시군구=="창원시" & 전입인구==0)) %>% 
  select(-성별)

전출인구 <- 전출인구 %>% 
  filter(!(시군구=="창원시" & 전출인구==0)) %>% 
  select(-성별)

# 데이터 병합
data <- 고령인구 %>% 
  left_join(등록외국인, by=c("시도", "시군구")) %>% 
  left_join(전입인구, by=c("시도", "시군구")) %>% 
  left_join(전출인구, by=c("시도", "시군구")) %>% 
  mutate(시군구=case_when(시군구 == "소계" ~ "",
                       T ~ 시군구)) %>% 
  unite("시군구", 시도:시군구, sep=" ") %>% 
  filter(grepl("(세종특별자치시)|(\\w+\\s\\w+)", 시군구)) %>% 
  mutate(시군구 = str_trim(시군구, side="both"))

# 데이터 확인
head(data)
```

    ## # A tibble: 6 × 6
    ##   시군구              `65세 이상 인구` `전체 인구` 등록외국인 전입인구 전출인구
    ##   <chr>                          <dbl>       <dbl>      <dbl>    <dbl>    <dbl>
    ## 1 서울특별시 종로구              28500      139417      11036    18238    19701
    ## 2 서울특별시 중구                25525      121312      10481    18860    17634
    ## 3 서울특별시 용산구              39239      213151      13955    28429    33660
    ## 4 서울특별시 성동구              49260      277361       7405    34789    38474
    ## 5 서울특별시 광진구              56461      335554      15626    44952    46500
    ## 6 서울특별시 동대문구            66790      341149      18724    50572    45202

## 기술통계량 표 작성하기

정리된 데이터를 사용해 기술통계량 표를 작성해 봅시다. 먼저 데이터를 긴
형태로 변환합니다. `pivot_longer`를 사용하면 여러 열을 하나의 열로
정리할 수 있습니다. 이후 `group_by`와 `summarise_at`을 사용해 각 변수의
평균, 표준편차, 최소값, 최대값, 표본수를 계산합니다.

``` r
# 기술통계량 표 작성
summary <- data %>% 
  pivot_longer(-시군구, names_to = "변수", values_to = "값") %>% 
  group_by(변수) %>% 
  summarise_at(vars(값), 
               list(평균 =  ~mean(.x, na.rm=T), 
                    표준편차 = ~sd(.x, na.rm=T), 
                    최소값 = ~min(.x, na.rm=T), 
                    최대값 = ~max(.x, na.rm=T), 
                    표본수 = ~sum(!is.na(.x))))
```

## 변수 순서 및 숫자 포맷 정리하기

정리된 기술통계량 표는 가독성을 높이기 위해 변수의 순서를 조정하고,
단위를 표기한 뒤 숫자에 콤마를 추가해 줍니다. `factor`를 이용해 변수
순서를 정렬하고, `mutate_at`을 사용해 변수명 뒤에 단위를 추가하고,
`mutate_if`를 사용해 숫자 값을 콤마 형식으로 변환합니다.

``` r
# 패키지 로드
library(scales)

# 데이터 표출 포맷 작성
reordered_summary <- summary %>% 
  mutate(변수 = factor(변수, levels = c("전체 인구", "65세 이상 인구", "등록외국인", "전입인구", "전출인구"))) %>% 
  arrange(변수) %>% 
  mutate_at(vars(변수), paste0, "(단위: 명)") %>% 
  mutate_if(is.numeric, comma, accuracy=1)
```

## 기술통계량 표 저장하기

마지막으로 정리된 기술통계량 표를 엑셀 파일로 저장합니다. `write_xlsx`
함수를 사용하면 파일로 쉽게 내보낼 수 있습니다.

``` r
# 패키지 로드
library(writexl)

# 파일 저장
write_xlsx(summary, 
           "아웃풋/분석자료 기술통계량.xlsx")
```

이번 글에서는 데이터를 준비하고 병합한 후, 기술통계량 표를 작성하는
과정을 차근차근 살펴봤습니다. 데이터의 평균, 표준편차, 최소값, 최대값
등을 정리하면 데이터의 전체적인 분포를 한눈에 파악할 수 있습니다. 직접
데이터에 적용해보고 활용해 보세요!
